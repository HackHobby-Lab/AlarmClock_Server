<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ESP32 Control Panel</title>
  <style>
    body { font-family: Arial, sans-serif; text-align: center; margin-top: 50px; }
    button { padding: 10px 20px; font-size: 16px; margin: 10px; }
    .content { margin-top: 20px; }
    .hidden { display: none; }
    .alarm-list { list-style-type: none; padding: 0; }
    .alarm-list li { margin: 10px 0; }
  </style>
  <script>
    let alarms = [];

    function showWiFiSettings() {
      document.getElementById('dateTimeSettings').classList.remove('hidden');
      document.getElementById('wifiSettings').classList.remove('hidden');
      document.getElementById('ledControl').classList.add('hidden');
      document.getElementById('alarmSettings').classList.add('hidden');
      document.getElementById('sleepSound').classList.add('hidden');
      document.getElementById('wakeupSound').classList.add('hidden');
      document.getElementById('phillipsHue').classList.add('hidden');
    }

    function showLEDControl() {
      document.getElementById('ledControl').classList.remove('hidden');
      document.getElementById('wifiSettings').classList.add('hidden');
      document.getElementById('dateTimeSettings').classList.add('hidden');
      document.getElementById('alarmSettings').classList.add('hidden');
      document.getElementById('sleepSound').classList.add('hidden');
      document.getElementById('wakeupSound').classList.add('hidden');
      document.getElementById('phillipsHue').classList.add('hidden');
    }

    // function showDateTimeSettings() {
    //   document.getElementById('wifiSettings').classList.remove('hidden');
    //   document.getElementById('dateTimeSettings').classList.remove('hidden');
      
    //   document.getElementById('ledControl').classList.add('hidden');
    //   document.getElementById('alarmSettings').classList.add('hidden');
    // }

    function showAlarmSettings() {
      document.getElementById('alarmSettings').classList.remove('hidden');
      document.getElementById('wifiSettings').classList.add('hidden');
      document.getElementById('ledControl').classList.add('hidden');
      document.getElementById('dateTimeSettings').classList.add('hidden');
      document.getElementById('sleepSound').classList.add('hidden');
      document.getElementById('wakeupSound').classList.add('hidden');
      document.getElementById('phillipsHue').classList.add('hidden');
    }

    function showWakeupSound() {
      document.getElementById('wifiSettings').classList.add('hidden');
      document.getElementById('ledControl').classList.add('hidden');
      document.getElementById('alarmSettings').classList.add('hidden');
      document.getElementById('wakeupSound').classList.remove('hidden');
      document.getElementById('sleepSound').classList.add('hidden');
      document.getElementById('phillipsHue').classList.add('hidden');
      document.getElementById('dateTimeSettings').classList.add('hidden');
    }

    function showSleepSound() {
      document.getElementById('wifiSettings').classList.add('hidden');
      document.getElementById('ledControl').classList.add('hidden');
      document.getElementById('alarmSettings').classList.add('hidden');
      document.getElementById('wakeupSound').classList.add('hidden');
      document.getElementById('sleepSound').classList.remove('hidden');
      document.getElementById('phillipsHue').classList.add('hidden');
      document.getElementById('dateTimeSettings').classList.add('hidden');
    }

    function showPhillipsHue() {
      document.getElementById('wifiSettings').classList.add('hidden');
      document.getElementById('ledControl').classList.add('hidden');
      document.getElementById('alarmSettings').classList.add('hidden');
      document.getElementById('wakeupSound').classList.add('hidden');
      document.getElementById('sleepSound').classList.add('hidden');
      document.getElementById('dateTimeSettings').classList.add('hidden');
      document.getElementById('phillipsHue').classList.remove('hidden');
    }

    function scanNetworks() {
      fetch('/scan')
        .then(response => response.json())
        .then(data => {
          let dropdown = document.getElementById('ssidSelect');
          dropdown.length = 0;
          let defaultOption = document.createElement('option');
          defaultOption.text = 'Select a network';
          dropdown.add(defaultOption);
          data.forEach(ssid => {
            let option = document.createElement('option');
            option.text = ssid;
            option.value = ssid;
            dropdown.add(option);
          });
        })
        .catch(error => console.error('Error:', error));
    }

    function updateSSIDField() {
      let selectedSSID = document.getElementById('ssidSelect').value;
      document.getElementById('ssid').value = selectedSSID;
    }

    function connectToNetwork() {
      let ssid = document.getElementById('ssid').value;
      let pass = document.getElementById('pass').value;

      fetch('/setWiFi', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/x-www-form-urlencoded',
        },
        body: `ssid=${encodeURIComponent(ssid)}&pass=${encodeURIComponent(pass)}`
      })
      .then(response => response.text())
      .then(data => alert(data))
      .catch(error => console.error('Error:', error));
    }

    function fetchWiFiStatus() {
      fetch('/wifiStatus')
        .then(response => response.json())
        .then(data => {
          document.getElementById('connectedNetwork').textContent = data.ssid;
          document.getElementById('ipAddress').textContent = data.ip;
        })
        .catch(error => console.error('Error:', error));
    }

    function toggleLED() {
      fetch('/toggleLED')
        .then(response => response.text())
        .then(data => {
          console.log('LED Status:', data);
        });
    }

    function changeLEDBrightness(value) {
      fetch(`/setBrightness?value=${value}`)
        .then(response => response.text())
        .then(data => {
          console.log('Brightness set to:', value);
        })
        .catch(error => console.error('Error:', error));
    }

    function setDateTime(event) {
      event.preventDefault();

      let date = document.getElementById('date').value;
      let time = document.getElementById('time').value;

      fetch('/setDateTime', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/x-www-form-urlencoded',
        },
        body: `date=${encodeURIComponent(date)}&time=${encodeURIComponent(time)}`
      })
      .then(response => response.text())
      .then(data => alert(data))
      .catch(error => console.error('Error:', error));
    }


function addAlarm(event) {
  event.preventDefault();

  let alarmTime = document.getElementById('alarmTime').value;
  let alarmId = Date.now();

  let alarm = { id: alarmId, time: `${alarmTime}` };
  //alarms.push(alarm);

  fetch('/addAlarm', {
    method: 'POST',
    headers: {
      'Content-Type': 'application/x-www-form-urlencoded',
    },
    body: `alarmTime=${encodeURIComponent(alarmTime)}`
  })
  .then(response => response.text())
  .then(data => alert(data))
  .catch(error => console.error('Error:', error));
}


function showCurrentTime() {
  const now = new Date();
  const hours = now.getHours() % 12 || 12; // Convert 24-hour format to 12-hour
  const minutes = String(now.getMinutes()).padStart(2, '0');
  const amPm = now.getHours() >= 12 ? 'PM' : 'AM';

  const currentTime = `${hours}:${minutes} ${amPm}`;
  document.getElementById('currentTime').innerText = `Current Time: ${currentTime}`;
}

setInterval(showCurrentTime, 1000); // Update time every second


    function deleteAlarm(alarmId) {
      alarms = alarms.filter(alarm => alarm.id !== alarmId);
      updateAlarmList();

      fetch('/deleteAlarm', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/x-www-form-urlencoded',
        },
        body: `alarmId=${encodeURIComponent(alarmId)}`
      })
      .then(response => response.text())
      .then(data => alert(data))
      .catch(error => console.error('Error:', error));
    }

    function updateAlarmList() {
      let alarmList = document.getElementById('alarmList');
      alarmList.innerHTML = '';

      alarms.forEach(alarm => {
        let listItem = document.createElement('li');
        listItem.textContent = `${alarm.time}`;
        let deleteButton = document.createElement('button');
        deleteButton.textContent = 'Delete';
        deleteButton.onclick = () => deleteAlarm(alarm.id);
        listItem.appendChild(deleteButton);
        alarmList.appendChild(listItem);
      });
    }

    window.onload = function() {
      fetchWiFiStatus();
      scanNetworks();
    };
  </script>
</head>
<body>
  <h1>ESP32 Control Panel</h1>

  <!-- Buttons for navigating between settings -->
  <div>
    <button onclick="showWiFiSettings()">System Settings</button>
    <button onclick="showLEDControl()">LED Control</button>
    <!-- <button onclick="showDateTimeSettings()">Date & Time Settings</button> -->
    <button onclick="showAlarmSettings()">Alarm Settings</button>
    <button onclick="showWakeupSound()">Wake-up Sound</button>
    <button onclick="showSleepSound()">Sleep Sound</button>
    <button onclick="showPhillipsHue()">Phillips Hue</button>
  </div>


    <!-- Date and Time Settings Section -->
    <div id="dateTimeSettings" class="content hidden">
      <div id="currentTime"></div>
      <h2>Date & Time Settings</h2>
      <form onsubmit="setDateTime(event); return false;">
        <label for="date">Date:</label><br>
        <input type="date" id="date" name="date"><br><br>
        
        <label for="time">Time:</label><br>
        <input type="time" id="time" name="time"><br><br>
        
        <input type="submit" value="Set Date & Time">
      </form>
    </div>

  <!-- Wi-Fi Settings Section -->
  <div id="wifiSettings" class="content hidden">
    <h2>Wi-Fi Configuration</h2>
    <form onsubmit="connectToNetwork(); return false;">
      <label for="ssid">SSID:</label><br>
      <select id="ssidSelect" name="ssidSelect" onchange="updateSSIDField()">
        <option>Select a network</option>
      </select><br><br>
      <input type="text" id="ssid" name="ssid" placeholder="Or enter SSID manually"><br><br>
      <label for="pass">Password:</label><br>
      <input type="password" id="pass" name="pass"><br><br>
      <input type="submit" value="Connect">
    </form>
    <h2>Current Wi-Fi Status</h2>
    <p>Connected Network: <span id="connectedNetwork">Not connected</span></p>
    <p>IP Address: <span id="ipAddress">N/A</span></p>
  </div>

  <!-- LED Control Section -->
  <div id="ledControl" class="content hidden">
    <h2>On-Board LED Control</h2>
    <button onclick="toggleLED()">Toggle LED</button><br><br>
    <label for="brightness">Brightness:</label><br>
    <input type="range" id="brightness" name="brightness" min="0" max="255" oninput="changeLEDBrightness(this.value)">
  </div>


  
<div id="alarmSettings" class="content hidden">
  <div id="currentTime"></div>
  <form onsubmit="addAlarm(event)">
    <label for="alarmTime">Select Time:</label>
    <input type="time" id="alarmTime" required>
    <button type="submit">Set Alarm</button>
  </form>
</div>



<!-- Wake-up Sound Section -->
<div id="wakeupSound" class="content hidden">
  <h2>Wake-up Sound</h2>
  <label for="wakeupSoundSelect">Choose a sound:</label>
  <select id="wakeupSoundSelect" name="wakeupSound">
    <option value="alarm1">Alarm tone 1</option>
    <option value="alarm2">Alarm tone 2</option>
    <option value="alarm3">Alarm tone 3</option>
  </select>

  <label for="wakeupVolume">Volume:</label>
  <input type="range" id="wakeupVolume" name="volume" min="0" max="255" oninput="changeVolume(this.value)">

  <button class="preview-button" onclick="previewWakeupSound()">Preview</button>
</div>

<!-- Sleep Sound Section -->
<div id="sleepSound" class="content hidden">
  <h2>Sleep Sound</h2>
  <p>(Streaming from URL)</p>
  <label for="sleepSoundSelect">Choose a sound:</label>
  <select id="sleepSoundSelect" name="sleepSound">
    <option value="rain">Rain</option>
    <option value="ocean">Ocean</option>
    <option value="forest">Forest</option>
  </select>

  <label for="sleepVolume">Volume:</label>
  <input type="range" id="sleepVolume" name="volume" min="0" max="255" oninput="changeVolume(this.value)">

  <button class="preview-button" onclick="previewSleepSound()">Preview</button>
</div>

<!-- Phillips Hue Section -->
<div id="phillipsHue" class="content hidden">
  <h2>Phillips Hue</h2>
  <!-- Placeholder for Phillips Hue controls -->
  <!-- Add specific controls here based on the functionality required -->
</div>
  
</body>
</html>
